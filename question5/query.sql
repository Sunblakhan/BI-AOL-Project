-- 1. Create the table structure for FINANCIAL_TRENDS_DIM
DROP TABLE IF EXISTS AOL_SCHEMA.FINANCIAL_TRENDS_DIM CASCADE;

CREATE TABLE AOL_SCHEMA.FINANCIAL_TRENDS_DIM (
    STOCK_DATE DATE,
    TICKER VARCHAR(10) UTF8,
    OPEN_PRICE DECIMAL(18,4),
    HIGH_PRICE DECIMAL(18,4),
    LOW_PRICE DECIMAL(18,4),
    CLOSE_PRICE DECIMAL(18,4),
    ADJ_CLOSE_PRICE DECIMAL(18,4), -- Crucial for analysis
    VOLUME DECIMAL(20,0)
);

-- 2. Set the Primary Key to the Composite Key of Date and Ticker
-- This ensures each stock (AAPL, EBAY) has only one price entry per day.
ALTER TABLE AOL_SCHEMA.FINANCIAL_TRENDS_DIM
ADD CONSTRAINT FINANCIAL_TRENDS_DIM_PK PRIMARY KEY (STOCK_DATE, TICKER) ENABLE;


-- ==========================================================
-- 3. Populate the FINANCIAL_TRENDS_DIM table using the data/FINANCIAL_TRENDS_DIM.csv file
-- ==========================================================
-- In the Database Explorer (left panel), find and right-click on FINANCIAL_TRENDS_DIM table
-- Look for one of these options:
-- Import Data from File
-- Import/Export → Import from File
-- Tools → Import Data
-- Select your CSV file
-- Configure the import settings and click OK
-- if doesn't work, manually import
    -- Clear any existing data first
DELETE FROM AOL_SCHEMA.FINANCIAL_TRENDS_DIM;

-- Insert EBAY data (correct column order: STOCK_DATE, TICKER, OPEN_PRICE, HIGH_PRICE, LOW_PRICE, CLOSE_PRICE, ADJ_CLOSE_PRICE, VOLUME)
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-01','EBAY',16.82,16.96,16.63,16.79,15.00,25215775);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-02','EBAY',16.74,16.99,16.63,16.93,15.12,31351320);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-03','EBAY',16.99,17.34,16.91,16.99,15.17,29702614);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-06','EBAY',16.63,17.07,16.68,16.76,14.96,18816019);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-07','EBAY',16.32,16.77,16.32,16.38,14.63,26355305);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-08','EBAY',16.18,16.33,15.56,15.85,14.16,55192579);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-09','EBAY',15.81,16.19,15.57,15.93,14.23,24626190);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-10','EBAY',15.82,16.04,15.64,15.94,14.24,26257176);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-13','EBAY',15.90,16.04,15.64,15.86,14.17,25242942);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-14','EBAY',16.54,16.61,15.86,16.46,14.70,23297155);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-15','EBAY',17.22,17.22,16.09,16.19,14.45,27819542);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-16','EBAY',16.14,16.38,16.10,16.16,14.43,17377589);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-20','EBAY',15.96,16.38,16.10,16.19,14.45,21909988);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-21','EBAY',15.96,16.45,15.91,15.96,14.25,20938738);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-22','EBAY',15.86,16.21,15.83,15.94,14.24,25358573);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-23','EBAY',15.96,16.33,15.66,15.72,14.04,30764448);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-24','EBAY',15.95,16.08,15.62,15.70,14.02,29019751);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-27','EBAY',15.76,15.82,15.61,15.64,13.96,20312186);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-28','EBAY',15.59,16.44,15.54,16.36,14.61,54532289);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-29','EBAY',16.33,16.74,16.27,16.55,14.78,34997292);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-30','EBAY',16.56,16.68,16.31,16.55,14.78,23259139);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-31','EBAY',16.62,16.67,16.37,16.41,14.66,17340286);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-03','EBAY',16.54,16.59,16.38,16.41,14.66,19546639);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-04','EBAY',16.42,16.65,16.37,16.58,14.81,18589111);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-05','EBAY',16.55,16.62,16.15,16.22,14.48,38290428);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-06','EBAY',16.22,16.59,16.13,16.33,14.58,25034724);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-07','EBAY',16.43,16.64,16.03,16.10,14.38,26585302);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-10','EBAY',16.12,16.19,15.86,16.03,14.32,20593742);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-11','EBAY',16.12,16.25,15.99,16.13,14.40,21589524);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-12','EBAY',16.09,16.30,16.08,16.19,14.46,13355258);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-13','EBAY',16.22,16.37,16.12,16.24,14.51,17850413);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-17','EBAY',16.17,16.37,15.83,16.01,14.29,16845840);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-18','EBAY',16.08,16.41,15.95,16.36,14.61,23665198);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-19','EBAY',16.70,17.18,16.67,16.98,15.17,62456962);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-20','EBAY',15.93,16.41,15.44,15.48,13.82,112863089);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-21','EBAY',15.61,15.62,14.67,14.77,13.19,136207289);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-24','EBAY',14.64,14.78,14.61,14.70,13.13,56314526);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-25','EBAY',14.78,14.81,14.39,14.52,12.96,51161695);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-26','EBAY',14.54,14.60,14.34,14.40,12.86,54117202);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-27','EBAY',14.32,14.66,14.14,14.62,13.05,60799702);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-28','EBAY',14.62,14.79,14.47,14.48,12.93,35666374);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-01','EBAY',14.53,14.62,14.34,14.44,12.90,32514134);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-02','EBAY',14.52,14.65,14.48,14.62,13.06,25794094);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-03','EBAY',14.60,14.73,14.23,14.38,12.84,29482596);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-04','EBAY',14.34,14.63,14.28,14.36,12.82,45622289);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-05','EBAY',14.40,14.44,13.47,13.63,12.17,129535243);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-08','EBAY',13.70,13.89,13.09,13.18,11.77,125894261);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-09','EBAY',13.29,13.67,13.18,13.41,11.98,82334340);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-10','EBAY',13.48,13.78,13.47,13.72,12.25,47716495);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-11','EBAY',13.75,13.80,13.38,13.48,12.04,35543772);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-12','EBAY',13.39,13.61,13.24,13.25,11.84,38707178);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-15','EBAY',13.19,13.40,13.01,13.14,11.74,38000318);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-16','EBAY',13.16,13.31,12.71,12.74,11.38,54905558);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-17','EBAY',12.68,12.82,12.34,12.42,11.09,76685400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-18','EBAY',12.46,12.62,12.23,12.47,11.14,50277110);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-19','EBAY',12.59,12.63,12.30,12.50,11.16,68363698);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-22','EBAY',12.30,12.56,12.15,12.53,11.19,48163658);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-23','EBAY',12.66,12.95,12.60,12.65,11.30,52594898);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-24','EBAY',12.72,12.89,12.39,12.71,11.35,52105205);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-25','EBAY',13.80,14.31,13.52,14.26,12.73,132070435);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-26','EBAY',14.48,14.57,14.17,14.39,12.86,61320758);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-30','EBAY',14.32,14.35,13.93,13.98,12.48,45714240);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-31','EBAY',13.98,14.02,3.62,13.81,12.33,48151303);

-- Insert AAPL data
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-01','AAPL',2.46,2.48,2.43,2.47,2.07,737817600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-02','AAPL',2.46,2.50,2.45,2.49,2.09,625273600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-03','AAPL',2.27,2.29,2.24,2.24,1.88,815791200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-06','AAPL',2.42,2.42,2.32,2.34,1.96,912665600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-07','AAPL',2.35,2.39,2.32,2.37,1.99,872877600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-08','AAPL',2.37,2.40,2.33,2.35,1.97,653251200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-09','AAPL',2.36,2.37,2.28,2.28,1.92,799304800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-10','AAPL',2.29,2.30,2.23,2.26,1.90,1043142800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-13','AAPL',2.32,2.37,2.31,2.35,1.97,861187200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-14','AAPL',2.35,2.40,2.34,2.40,2.02,642020400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-15','AAPL',2.42,2.43,2.34,2.37,1.99,891996000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-16','AAPL',2.39,2.39,2.30,2.30,1.93,749638400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-17','AAPL',2.31,2.34,2.29,2.31,1.94,812042000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-20','AAPL',2.33,2.34,2.28,2.29,1.92,605441200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-21','AAPL',2.22,2.30,2.19,2.21,1.85,1345366400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-22','AAPL',2.22,2.26,2.19,2.20,1.85,1345895600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-23','AAPL',2.21,2.21,2.13,2.15,1.80,1427826400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-24','AAPL',2.15,2.18,2.11,2.14,1.80,1071980000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-27','AAPL',2.16,2.19,2.12,2.13,1.78,1108072000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-28','AAPL',2.13,2.15,2.08,2.10,1.76,1370322800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-29','AAPL',2.11,2.23,2.06,2.23,1.87,2346650000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-30','AAPL',2.24,2.26,2.20,2.24,1.88,1390650800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-03-31','AAPL',2.26,2.27,2.22,2.24,1.88,815357200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-03','AAPL',2.39,2.39,2.34,2.34,1.97,707028000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-04','AAPL',2.22,2.25,2.18,2.22,1.86,931924000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-05','AAPL',2.31,2.40,2.29,2.40,2.02,2233408800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-06','AAPL',2.44,2.57,2.44,2.54,2.14,2663768800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-07','AAPL',2.53,2.54,2.45,2.49,2.09,1545238800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-10','AAPL',2.51,2.53,2.44,2.45,2.06,903515200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-11','AAPL',2.46,2.47,2.40,2.43,2.04,939316000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-12','AAPL',2.43,2.43,2.37,2.38,2.00,739894400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-13','AAPL',2.37,2.41,2.36,2.37,1.99,734678400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-17','AAPL',2.38,2.39,2.30,2.31,1.94,721938000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-18','AAPL',2.32,2.37,2.31,2.37,1.99,794844400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-19','AAPL',2.39,2.39,2.34,2.34,1.97,1086033200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-20','AAPL',2.48,2.50,2.36,2.42,2.03,1666982800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-21','AAPL',2.44,2.45,2.37,2.39,2.01,788986800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-24','AAPL',2.39,2.39,2.34,2.36,1.97,707028000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-25','AAPL',2.36,2.38,2.34,2.36,1.98,529062800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-26','AAPL',2.38,2.44,2.37,2.43,2.04,710886400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-27','AAPL',2.42,2.49,2.41,2.48,2.08,845947200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-04-28','AAPL',2.48,2.55,2.47,2.51,2.11,760037600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-01','AAPL',2.53,2.56,2.47,2.49,2.09,750380400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-02','AAPL',2.51,2.57,2.50,2.56,2.15,771663200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-03','AAPL',2.57,2.57,2.54,2.54,2.13,686991200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-04','AAPL',2.57,2.60,2.52,2.54,2.13,860420400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-05','AAPL',2.57,2.58,2.54,2.57,2.16,563911600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-08','AAPL',2.61,2.64,2.56,2.57,2.16,594851600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-09','AAPL',2.57,2.59,2.52,2.54,2.13,531666800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-10','AAPL',2.55,2.55,2.49,2.52,2.12,459888800);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-11','AAPL',2.42,2.45,2.39,2.42,2.03,641774000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-12','AAPL',2.42,2.45,2.39,2.42,2.03,641774000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-15','AAPL',2.41,2.44,2.40,2.42,2.03,529177600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-16','AAPL',2.43,2.44,2.31,2.32,1.95,936740000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-17','AAPL',2.31,2.35,2.29,2.33,1.96,754194000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-18','AAPL',2.35,2.37,2.25,2.26,1.89,658442400);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-19','AAPL',2.32,2.34,2.30,2.31,1.94,985866000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-22','AAPL',2.28,2.29,2.24,2.26,1.90,718975600);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-23','AAPL',2.32,2.33,2.25,2.26,1.89,694414000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-24','AAPL',2.30,2.30,2.26,2.30,1.93,916031200);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-25','AAPL',2.30,2.30,2.26,2.30,1.93,463372000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-26','AAPL',2.30,2.31,2.26,2.27,1.91,432950000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-30','AAPL',2.26,2.26,2.19,2.19,1.84,563402000);
INSERT INTO AOL_SCHEMA.FINANCIAL_TRENDS_DIM VALUES ('2006-05-31','AAPL',2.21,2.21,2.10,2.13,1.79,1280977600);
-- ==========================================================
-- 4. Query the data for the plot
-- ==========================================================
WITH Daily_Digital_Searches AS (
    -- 1. Aggregate the daily count of high-intent digital searches
    SELECT
        T."year" || '-' || 
        CASE TRIM(T."month") WHEN 'march' THEN '03' WHEN 'april' THEN '04' WHEN 'may' THEN '05' END || '-' || 
        T."day of the month" AS Date_Key,
        COUNT(F.QUERYID) AS Total_Daily_Digital_Searches
    FROM
        AOL_SCHEMA.FACTS F
    JOIN
        AOL_SCHEMA.TIMEDIM T ON F.TIMEID = T.ID
    JOIN
        AOL_SCHEMA.DIGITAL_QUERY_IDS DQI ON F.QUERYID = DQI.QUERYID
    WHERE
        F.CLICK = TRUE 
    GROUP BY 1
),
Cumulative_AOL_Trend AS (
    -- 2. FIX: Calculate the Cumulative Average (fully supported advanced window function)
    SELECT
        DDS.Date_Key,
        DDS.Total_Daily_Digital_Searches,
        -- CRITICAL FIX: Use the supported UNBOUNDED PRECEDING frame
        AVG(DDS.Total_Daily_Digital_Searches) 
        OVER (
            ORDER BY DDS.Date_Key ASC
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
        ) AS Cumulative_Search_Avg -- Renamed metric
    FROM
        Daily_Digital_Searches DDS
)
-- 3. Final Join: Correlate the internal AOL trend with the external financial trend
SELECT
    CAT.Date_Key,
    CAT.Total_Daily_Digital_Searches,
    ROUND(CAT.Cumulative_Search_Avg, 3) AS Cumulative_Search_Avg,
    FTD.ADJ_CLOSE_PRICE,
    FTD.TICKER
FROM
    Cumulative_AOL_Trend CAT
JOIN
    AOL_SCHEMA.FINANCIAL_TRENDS_DIM FTD 
    ON CAT.Date_Key = TO_CHAR(FTD.STOCK_DATE, 'YYYY-MM-DD')
WHERE
    FTD.TICKER = 'EBAY'
ORDER BY CAT.Date_Key;
